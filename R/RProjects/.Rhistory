lfcrit <- sortq[frank]
qfiletempf$diff <- (qfiletempf$discharge-lfcrit)
jul_day_sum <- aggregate(qfiletempf$diff, list(qfiletempf$jul_val), sum)
maxdur <- rep(0,nrow(jul_day_sum))
flag <- 0
for (i in 1:365) {
if (!is.na(jul_day_sum$x[i])==TRUE) {
if (jul_day_sum$x[i]<=0) {
flag <- flag+1
maxdur[i]<-flag
}} else {
maxdur[i] <- 0
}
}
maxdur
th3 <- max(maxdur)/365
th3
diffbtdays <- diff(log10(qfiletempf$discharge), lag = 1,
differences = 1)
findrisevalues <- subset(diffbtdays, diffbtdays >
0)
ra6 <- median(findrisevalues)
ra6
diffbtdays <- diff(qfiletempf$discharge, lag = 1,
differences = 1)
findrisevalues <- subset(diffbtdays, diffbtdays >
0)
ra6 <- median(log10(findrisevalues))
ra6
diffbtdays <- diff(log10(qfiletempf$discharge), lag = 1,
differences = 1)
findrisevalues <- subset(diffbtdays, diffbtdays >
0)
ra6 <- median(findrisevalues)
ra6
diffbtdays <- diff(log10(qfiletempf$discharge), lag = 1,
differences = 1)
findrisevalues <- subset(diffbtdays, diffbtdays <
0)
ra7 <- median(sub_flow_diff)
diffbtdays <- diff(log10(qfiletempf$discharge), lag = 1,
differences = 1)
findfallvalues <- subset(diffbtdays, diffbtdays <
0)
ra7 <- median(findfallvalues)
ra7
noyears <- unique(qfiletempf$wy_val)
noyrs <- nrow(noyears)
for (j in 1:noyrs) {
subq <- subset(qfiletempf,qfiletempf$wy_val==noyears[j])
counter <- 0
sub_length <- nrow(subq)-1
for (i in 2:sub_length) {
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
}
}
noyears
length(noyears)
noyears <- data.frame(unique(qfiletempf$wy_val))
noyears
noyears <- data.frame(unique(qfiletempf$wy_val),rownames=FALSE)
noyears
noyears <- data.frame(unique(qfiletempf$wy_val))
str(noyears)
noyears <- data.frame(unique(qfiletempf$wy_val),stringsAsFactors=FALSE)
str(noyears)
noyears
noyears <- data.frame(unique(qfiletempf$wy_val),stringsAsFactors=FALSE)
noyrs <- nrow(noyears)
for (j in 1:noyrs) {
subq <- subset(qfiletempf,qfiletempf$wy_val==noyears[j])
counter <- 0
sub_length <- nrow(subq)-1
for (i in 2:sub_length) {
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
}
noyears$cnt[j] <- counter
}
qfiletempf$discharge[i+1]-qfiletempf$discharge[i]
qfiletempf$discharge[i]-qfiletempf$discharge[i-1]
i
j
sub_length
subq
subq <- subset(qfiletempf,as.numeric(qfiletempf$wy_val)==noyears[j])
subq
noyears
noyears[j]
noyears <- data.frame(unique(qfiletempf$wy_val),stringsAsFactors=FALSE)
colnames(noyears) <- c("wy_val")
noyrs <- nrow(noyears)
noyears[j]
noyears
noyears$wy_val[j]
for (j in 1:noyrs) {
subq <- subset(qfiletempf,qfiletempf$wy_val==noyears$wy_val[j])
counter <- 0
sub_length <- nrow(subq)-1
for (i in 2:sub_length) {
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
}
noyears$cnt[j] <- counter
}
noyears
subq
str(qfiletempf)
qfiletempf<-obs_data
str(qfiletempf)
noyears <- data.frame(unique(qfiletempf$wy_val),stringsAsFactors=FALSE)
colnames(noyears) <- c("wy_val")
noyrs <- nrow(noyears)
noyears
j
j<-1
subq <- subset(qfiletempf,qfiletempf$wy_val==noyears$wy_val[j])
counter <- 0
sub_length <- nrow(subq)-1
subq
sub_length
i<-2
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
}
counter
i<-3
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
counter
noyears <- data.frame(unique(qfiletempf$wy_val),stringsAsFactors=FALSE)
colnames(noyears) <- c("wy_val")
noyrs <- nrow(noyears)
for (j in 1:noyrs) {
subq <- subset(qfiletempf,qfiletempf$wy_val==noyears$wy_val[j])
counter <- 0
sub_length <- nrow(subq)-1
for (i in 2:sub_length) {
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
}
noyears$cnt[j] <- counter
}
noyears
View(subq)
i<-3
counter
counter<-0
if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]<0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]>0) {
counter <- counter+1
} else if (qfiletempf$discharge[i+1]-qfiletempf$discharge[i]>0 && qfiletempf$discharge[i]-qfiletempf$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
counter
i
qfiletempf$discharge[i+1]-qfiletempf$discharge[i]
qfiletempf$discharge[i]-qfiletempf$discharge[i-1]
noyears <- data.frame(unique(qfiletempf$wy_val),stringsAsFactors=FALSE)
colnames(noyears) <- c("wy_val")
noyrs <- nrow(noyears)
for (j in 1:noyrs) {
subq <- subset(qfiletempf,qfiletempf$wy_val==noyears$wy_val[j])
counter <- 0
sub_length <- nrow(subq)-1
for (i in 2:sub_length) {
if (subq$discharge[i+1]-subq$discharge[i]<0 && subq$discharge[i]-subq$discharge[i-1]>0) {
counter <- counter+1
} else if (subq$discharge[i+1]-subq$discharge[i]>0 && subq$discharge[i]-subq$discharge[i-1]<0) {
counter <- counter+1
} else {counter<-counter}
}
noyears$cnt[j] <- counter
}
noyears
ra8 <- mean(noyears$cnt)
sd_diff <- sd(noyears$cnt)
ra9 <- (sd_diff*100)/ra8
ra8.9 <- list(ra8=ra8,ra9=ra9)
ra8.9
sdbyyr <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = sd, na.rm=TRUE)
colnames(sdbyyr) <- c("Year", "sdq")
meanbyyr <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
mean, na.rm=TRUE)
colnames(meanbyyr) <- c("Year", "meanq")
dfcvbyyr <- data.frame(meanbyyr$Year, sdbyyr$sdq,
meanbyyr$meanq)
colnames(dfcvbyyr) <- c("Year", "sdq", "meanq")
cvbyyr <- dfcvbyyr$sdq/dfcvbyyr$meanq
dfcvbyyrf <- data.frame(dfcvbyyr, cvbyyr)
colnames(dfcvbyyrf) <- c("Year", "sdq", "meanq",
"cvq")
meancv <- mean(dfcvbyyrf$cvq, na.rm=TRUE)
ma3 <- (meancv) * 100
ma3
medcv <- median(dfcvbyyrf$cvq, na.rm=TRUE)
ma3 <- (medcv) * 100
ma3
hfcrit <- ma2(qfiletempf)
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$wy_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit) {
flag <- flag+1
temp <- subsetyr$discharge[j]-hfcrit
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh24 <- meanex/ma2(qfiletempf)
mh24
hfcrit <- ma2(qfiletempf)
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$wy_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit) {
flag <- flag+1
temp <- subsetyr$discharge[j]
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh24 <- meanex/ma2(qfiletempf)
mh24
hfcrit <- 3 * ma2(qfiletempf)
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$wy_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit) {
flag <- flag+1
temp <- subsetyr$discharge[j]
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh25 <- meanex/ma2(qfiletempf)
mh25
hfcrit <- 7 * ma2(qfiletempf)
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$wy_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit) {
flag <- flag+1
temp <- subsetyr$discharge[j]
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh26 <- meanex/ma2(qfiletempf)
mh26
isolateq <- qfiletempf$discharge
sortq <- sort(isolateq)
frank75 <- floor(findrank(length(sortq),0.75))
hfcrit75 <- sortq[frank75]
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$wy_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit75) {
flag <- flag+1
temp <- subsetyr$discharge[j]
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh27 <- meanex/ma2(qfiletempf)
mh27
isolateq <- qfiletempf$discharge
sortq <- sort(isolateq)
frank75 <- floor(findrank(length(sortq),0.25))
hfcrit75 <- sortq[frank75]
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$wy_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$wy_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit75) {
flag <- flag+1
temp <- subsetyr$discharge[j]
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh27 <- meanex/ma2(qfiletempf)
mh27
isolateq <- qfiletempf$discharge
sortq <- sort(isolateq)
frank75 <- floor(findrank(length(sortq),0.25))
hfcrit75 <- sortq[frank75]
noyears <- aggregate(qfiletempf$discharge, list(qfiletempf$year_val),
FUN = median, na.rm=TRUE)
colnames(noyears) <- c("Year", "momax")
noyrs <- length(noyears$Year)
peak <- rep(0,nrow(qfiletempf))
nevents <- 1
for (i in 1:noyrs) {
subsetyr <- subset(qfiletempf, as.numeric(qfiletempf$year_val) == noyears$Year[i])
flag <- 0
peak[i] <- 0
for (j in 1:nrow(subsetyr)) {
if (subsetyr$discharge[j]>hfcrit75) {
flag <- flag+1
temp <- subsetyr$discharge[j]
nevents <- ifelse(flag==1,nevents+1,nevents)
peak[nevents] <- ifelse(temp>peak[nevents],temp,peak[nevents])
} else {flag <- 0}
}
}
peak_sub <- subset(peak,peak>0)
meanex <- mean(peak_sub)
mh27 <- meanex/ma2(qfiletempf)
mh27
hfcrit <- 7 * ma2(qfiletempf)
highflow <- subset(qfiletempf,qfiletempf$discharge>hfcrit)
if (nrow(highflow)>0) {
highbyyr <- aggregate(highflow$discharge,list(highflow$wy_val),FUN=length)
if (pref == "median") {
fh4 <- median(highbyyr$x)
}
else {
fh4 <- mean(highbyyr$x)
}}
else {
fh4 <- 'NA'
}
mean(highbyyr$x)
median(highbyyr$x)
library(devtools)
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
load_data<-paste(system.file(package="HITHATStats"),"/data/obs_data.csv",sep="")
qfiletempf<-read.csv(load_data)
sites<-"02178400"
peakValues<-getPeakData(sites)
thresh<-getPeakThresh(qfiletempf,peakValues)
peakValues
thresh
peakDaily <- aggregate(obs_data$discharge,list(obs_data$wy_val),max)
obs_data<-qfiletempf\
obs_data<-qfiletempf
peakDaily <- aggregate(obs_data$discharge,list(obs_data$wy_val),max)
colnames(peakDaily) <- c("wy_val","discharge")
peakInst <- peakValues[as.numeric(peakValues$wy_val)>=min(as.numeric(peakDaily$wy_val)) & as.numeric(peakValues$wy_val)<=max(as.numeric(peakDaily$wy_val)),]
peakDaily$logval <- log10(peakDaily$discharge)
dailyMean <- mean(peakDaily$logval)
instMean <- mean(peakInst$logval)
num <- sum((peakDaily$logval-dailyMean)*(peakInst$logval-instMean))
denom <- sum((peakInst$logval-instMean)*(peakInst$logval-instMean))
b <- num/denom
a <- dailyMean - (b*instMean)
isolateq <- peakInst$logval
sortq <- sort(isolateq)
frank <- floor(findrank(length(sortq), 0.6))
lfcrit <- sortq[frank]
lq167 <- a + (b*lfcrit)
thresh <- 10^(lq167)
thresh
lq167
lfcrit
frank
length(sortq)
nrow(sortq)
sortq
peakValues
peakDaily
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
# Build the package:
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/HITHATStats")
document()
check()
run_examples()
library(NWCCompare)
run_examples()
library(devtools)
setwd("C:/Users/jlthomps/Desktop/git/USGS-NWC/R/RProjects/")
load_all("HITHATStats/",reset = TRUE)
